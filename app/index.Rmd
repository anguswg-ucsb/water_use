---
title: "Water use"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    navbar:
      - { icon: "fa-question-circle", href: "https://github.com/anguswg-ucsb/water_use", align: right }
    theme: flatly
    orientation: rows
    source_code: embed
    vertical_layout: fill
---


```{r setup, include = FALSE}
library(shiny)
library(flexdashboard)
library(shinyWidgets)

library(dplyr)
library(tidyr)
library(dataRetrieval)

library(DT)
library(highcharter)

source('utils.R')
```


```{r context="server"}
#Initialize Maps 
# output$conusMap     <- renderLeaflet({ basemap() })

state_lst <- as.list(state.name)
counties <- USAboundaries::us_counties()

# output$countyMap <- renderLeaflet({ pop_map(pop) })

```

US water use {data-icon="fa-tint"}
=====================================

Inputs {.sidebar}
-------------------------------------

### Model Filters
```{r}
dateRangeInput("dateTS", label = "Date Range Input",
               start = "1993-01-01",
               end = "2018-12-31",
               min = "1993-01-01",
               max = "2018-12-31",
               format = "yyyy mm dd",
               weekstart = 1)
uiOutput("stateSelect")
uiOutput("countySelect")

```

```{r context="server"}
output$stateSelect <- renderUI({
   selectInput("stateSearch", "Choose state:",
               as.list(unique(counties$state_name)),
               multiple= FALSE,
               selectize = TRUE)
})
output$countySelect <- renderUI({
   selectInput("countySearch", "Choose county:",
               choices = NULL,
               multiple= FALSE,
               selectize = TRUE)
})



```

### **Submit**
```{r}
shiny::actionButton("submitButton", label = "Enter", icon("search"))
```

Row
-----------------------------------------------
```{r}
verbatimTextOutput("stateText")

verbatimTextOutput("countyText")
```

```{r context="server"}
stateName <- eventReactive(input$submitButton, {
    filter(counties, state_name == input$stateSearch)
  })
# state <- reactive({
#   filter(counties, state_name == input$stateSearch)
# })

observeEvent(stateName(), {
  choices <- stateName()$name
  updateSelectInput(session, inputId = "countySearch", choices = choices) 
})
output$stateText <- renderPrint({
   stateName()
  })

countyName <- eventReactive(input$submitButton, {
    input$countySearch
  })

output$countyText <- renderPrint({
   countyName()
  })
```












